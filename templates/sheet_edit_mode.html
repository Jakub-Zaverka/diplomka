<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>User Info - Edit</title>
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous"> -->
    <link rel="stylesheet" href="{{ url_for('static',filename='custom.css') }}">
    <link rel="stylesheet" href="{{ url_for('static',filename='styles.css') }}">
    <script src="{{ url_for('static', filename='scripts.js') }}"></script>

</head>

<body class="bg-white">
    <!-- <h1>PH:Char_id:{{ character.char_id }} Char name:{{ character.name }} User_id:{{ character.user_id }}</h1> -->
    <div class="row">
        <div class="col-12 col-lg-6 row d-none d-lg-flex">

            <!-- Atributes -->
            <div class="col-12 col-md-7 px-md-3">
                <div class="order-md-1">
                    <div class="row">
                        <div class="bg-light row shadow mx-0 py-1">
                            <div class="col-2 ">
                                <div class="row">
                                    <!-- <p class="h3 my-0">+5</p> -->
                                </div>
                                <div class="row ">
                                    <h3>Value</h3>
                                </div>
                            </div>
                            <div class="col-10 align-self-center">
                                <p class="h3 w-100 word-wrap: break-word px-4">Atribute Name</p>
                            </div>
                        </div>
                    </div>
                    <!-- Individual Atribute -->
                    {% for item in data_page_template["atributes"] %}
                    <div class="row ">
                        <div class="bg-light row shadow mx-0 py-1">
                            <!-- Levý sloupec s hodnotou -->
                            <div class="col-2 d-flex align-items-center justify-content-center">
                                <input class="form-control border-0 bg-primary text-center ms-2 auto_update_stats"
                                    style="width: 70px; height: 70px; font-size: 2rem; box-shadow: none;"
                                    id='{{ item["name"].lower() }}' value='{{ character[item["name"]] }}'>
                            </div>

                            <!-- Pravý sloupec s názvem + proficiency -->
                            <div class="col-10 align-self-center">
                                <p class="h3 w-100 text-wrap px-4">{{ item["name"] }}</p>
                                {% set skill_key = item["name"] | lower | replace(' ', '_') %}
                                {% set level = proficiencies.get(skill_key, 1) %}
                                <div class="row px-2">
                                    <div class="col-12 d-flex gap-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" id="skillNone_{{ skill_key }}"
                                                name="skill_{{ skill_key }}" value="1" {% if level==1 %}checked{% endif
                                                %} onchange="updateSkill('{{ item['name'].lower() }}', this.value)">
                                            <label class="form-check-label" for="skillNone_{{ skill_key }}">None</label>
                                        </div>

                                        <div class="form-check">
                                            <input class="form-check-input" type="radio"
                                                id="skillProficient_{{ skill_key }}" name="skill_{{ skill_key }}"
                                                value="2" {% if level==2 %}checked{% endif %}
                                                onchange="updateSkill('{{ item['name'].lower() }}', this.value)">
                                            <label class="form-check-label"
                                                for="skillProficient_{{ skill_key }}">Proficient</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}



                </div>
            </div>
            <!-- TODO: Proficiency with skills -->
            <!-- Skills -->
            <div class="col-12 col-md-5 order-md-2 px-md-3">
                <!-- celý blok -->
                <div class="bg-light row shadow px-0">
                    <!-- Header -->
                    <div class="col-12">
                        <h5 class="my-2 px-3">Proficiency</h5>
                    </div>

                    <!-- Scrollable skills container -->
                    <div class="col-12 skills-container overflow-auto" style="max-height: 80vh;">
                        {% for item in data_page_template["skills"] %}
                        {% set skill_key = item["name"] | lower | replace(' ', '_') %}
                        {% set level = proficiencies.get(skill_key, 1) %}
                        <div class="bg-light row shadow-sm px-3 py-2 mb-2 rounded-0">
                            <!-- Skill name -->
                            <div class="col-12">
                                <p class="h5 w-100 text-wrap mb-2">{{ item["name"] }}</p>
                            </div>

                            <!-- Radios -->
                            <div class="col-12 d-flex gap-3 flex-wrap">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" id="skillNone_{{ skill_key }}"
                                        name="skill_{{ skill_key }}" value="1" {% if level==1 %}checked{% endif %}
                                        onchange="updateSkill('{{ skill_key }}', this.value)">
                                    <label class="form-check-label" for="skillNone_{{ skill_key }}">None</label>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input" type="radio" id="skillProficient_{{ skill_key }}"
                                        name="skill_{{ skill_key }}" value="2" {% if level==2 %}checked{% endif %}
                                        onchange="updateSkill('{{ skill_key }}', this.value)">
                                    <label class="form-check-label"
                                        for="skillProficient_{{ skill_key }}">Proficient</label>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input" type="radio" id="skillExpertise_{{ skill_key }}"
                                        name="skill_{{ skill_key }}" value="3" {% if level==3 %}checked{% endif %}
                                        onchange="updateSkill('{{ skill_key }}', this.value)">
                                    <label class="form-check-label"
                                        for="skillExpertise_{{ skill_key }}">Expertise</label>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>



        </div>
        <!-- Health -->
        <div class="no-gutters-edit col-12 col-lg-6 px-4">
            <div class="row bg-light shadow">
                <div class="col-12">
                    <div class="row m-1">
                        <form class="col-12 col-md-10 p-2 compact-form">
                            <div class="row g-2">
                                <div class="col-6 col-md">
                                    <label for="name" class="form-label">Name</label>
                                    <input id="name" type="text"
                                        class="form-control form-control-sm auto_update_stats bg-primary "
                                        value="{{ character.name }}">
                                </div>
                                <div class="col-6 col-md">
                                    <label for="level" class="form-label">Level</label>
                                    <input id="level" type="text"
                                        class="form-control form-control-sm auto_update_stats bg-primary "
                                        value="{{ character.level }}">
                                </div>
                                <div class="col-6 col-md">
                                    <label for="char_race" class="form-label">Race</label>
                                    <select id="char_race"
                                        class="form-select form-select-sm auto_update_stats bg-primary ">
                                        <option selected>Select Race</option>
                                        {% for item in player_races %}
                                        {% if item == character.char_race %}
                                        <option selected value="{{ item }}">{{ item | capitalize }}</option>
                                        {% else %}
                                        <option value="{{ item }}">{{ item | capitalize }}</option>
                                        {% endif %}
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-6 col-md">
                                    <label for="ac" class="form-label">AC</label>
                                    <input id="ac" type="text"
                                        class="form-control form-control-sm auto_update_stats bg-primary "
                                        value="{{ character.ac }}">
                                </div>
                                <div class="col-6 col-md">
                                    <label for="max_hp" class="form-label">Max HP</label>
                                    <input id="max_hp" type="text"
                                        class="form-control form-control-sm auto_update_stats bg-primary "
                                        value="{{ character.max_hp }}">
                                </div>
                                <div class="col-6 col-md">
                                    <label for="speed" class="form-label">Move Speed</label>
                                    <input id="speed" type="text"
                                        class="form-control form-control-sm auto_update_stats bg-primary "
                                        value="{{ character.speed }}">
                                </div>
                            </div>

                            <div class="row g-2 mt-2">
                                <div class="col-6 col-md">
                                    <label for="char_class" class="form-label">Class</label>
                                    <select id="char_class"
                                        class="form-select form-select-sm auto_update_stats bg-primary ">
                                        <option selected>Select Class</option>
                                        {% for item in player_classes %}
                                        {% if item == character.char_class %}
                                        <option selected value="{{ item }}">{{ item | capitalize }}</option>
                                        {% else %}
                                        <option value="{{ item }}">{{ item | capitalize }}</option>
                                        {% endif %}
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-6 col-md">
                                    <label for="char_subclass" class="form-label">Subclass</label>
                                    <select id="char_subclass" name="char_subclass"
                                        class="form-select form-select-sm auto_update_stats bg-primary ">
                                        <option value="">None</option>
                                        {% set subclasses = data_page_template["subclasses"][character["char_class"]] |
                                        default([]) %}
                                        {% for subclass in subclasses %}
                                        <option value="{{ subclass }}" {% if subclass==character["char_subclass"]
                                            %}selected{% endif %}>
                                            {{ subclass.replace('_', ' ') | title }}
                                        </option>
                                        {% endfor %}
                                    </select>
                                </div>

                            </div>
                        </form>

                        <div class="col-12 col-md-2 text-center align-content-center mt-2 mt-md-0">
                            <button class="edit-button btn btn-warning btn-sm w-100"
                                data-url="{{ url_for('sheet', char_id=character['char_id']) }}">
                                Exit Edit Mode
                            </button>
                        </div>
                    </div>

                    <!-- TABLIST: Feats & Class Choices -->
                    <div class="mt-3">
                        <nav>
                            <div class="nav nav-tabs" id="feat-class-tab" role="tablist">
                                <button class="nav-link active" id="nav-feats-tab" data-bs-toggle="tab"
                                    data-bs-target="#nav-feats" type="button" role="tab" aria-controls="nav-feats"
                                    aria-selected="true">Feats</button>
                                <button class="nav-link" id="nav-classchoices-tab" data-bs-toggle="tab"
                                    data-bs-target="#nav-classchoices" type="button" role="tab"
                                    aria-controls="nav-classchoices" aria-selected="false">Class Choices</button>
                                <button class="nav-link d-block d-lg-none" id="nav-stats-tab" data-bs-toggle="tab"
                                    data-bs-target="#nav-stats" type="button" role="tab" aria-controls="nav-stats"
                                    aria-selected="false">Stats</button>
                                <button class="nav-link d-block d-lg-none" id="nav-skills-tab" data-bs-toggle="tab"
                                    data-bs-target="#nav-skills" type="button" role="tab" aria-controls="nav-skills"
                                    aria-selected="false">Skills</button>
                            </div>
                        </nav>

                        <div class="tab-content" id="feat-class-tabContent">
                            <!-- FEATS TAB -->
                            <div class="tab-pane fade show active p-3" id="nav-feats" role="tabpanel"
                                aria-labelledby="nav-feats-tab">
                                <div class="tab-scroll-wrapper-edit-mode">
                                    {% set feat_levels = [
                                    {'level': 0, 'label': 'Origin Feat', 'filter': 'origin'},
                                    {'level': 4, 'label': 'Level 4 Feat', 'filter': 'non-epic'},
                                    {'level': 8, 'label': 'Level 8 Feat', 'filter': 'non-epic'},
                                    {'level': 12, 'label': 'Level 12 Feat', 'filter': 'non-epic'},
                                    {'level': 16, 'label': 'Level 16 Feat', 'filter': 'non-epic'},
                                    {'level': 19, 'label': 'Level 19 Feat/Epic Boon', 'filter': 'all'}
                                    ] %}

                                    {% if character.char_race == 'human' %}
                                    {% set feat_levels = feat_levels + [{'level': 1, 'label': 'Origin Feat (Human
                                    Bonus)',
                                    'filter': 'origin'}] %}
                                    {% endif %}
                                    {% if character.char_class == 'fighter' %}
                                    {% set feat_levels = feat_levels + [
                                    {'level': 6, 'label': 'Fighter Feat level 6', 'filter': 'non-epic'},
                                    {'level': 14, 'label': 'Fighter Feat level 14', 'filter': 'non-epic'}
                                    ] %}
                                    {% endif %}
                                    {% if character.char_class == 'rogue' %}
                                    {% set feat_levels = feat_levels + [{'level': 10, 'label': 'Rogue Feat level 10',
                                    'filter': 'non-epic'}] %}
                                    {% endif %}


                                    <div class="row">
                                        <div class="col-lg-8">
                                            {% for conf in feat_levels %}
                                            <div class="mb-3">
                                                <label class="form-label">{{ conf.label }}</label>
                                                <select class="form-select bg-primary" onchange="postFeat(this)"
                                                    data-level="{{ conf.level }}">
                                                    <option value="0">Select Feat</option>
                                                    {% for item in data_page_template['feats'].values() %}
                                                    {% if conf.filter == 'origin' and item['type'] == 'origin'
                                                    or conf.filter == 'non-epic' and item['type'] != 'epic'
                                                    or conf.filter == 'all' %}
                                                    <option value="{{ item['UUID'] }}" {% if
                                                        known_feats.get(conf.level)==item['UUID'] %}selected{% endif %}
                                                        data-description="{{ item['description'] }}">
                                                        {{ item['name'] | capitalize }}
                                                    </option>
                                                    {% endif %}
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            {% endfor %}
                                        </div>
                                        <div class="col-lg-4">
                                            <div id="feat-description" class="border rounded p-3 bg-light"
                                                style="min-height:150px;">
                                                <p class="text-muted">Select a feat to see its description.</p>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <!-- CLASS CHOICES TAB -->
                            <div class="tab-pane fade p-3" id="nav-classchoices" role="tabpanel"
                                aria-labelledby="nav-classchoices-tab">
                                <div class="tab-scroll-wrapper-edit-mode">
                                    <div class="row">
                                        <div class="col-lg-8">

                                            {% set class_options = data_page_template.get('option_' ~
                                            (character.char_class or ''), {}) %}
                                            {% if character.char_subclass %}
                                            {% set subclass_key = 'option_' ~ character.char_class ~ '_' ~
                                            character.char_subclass %}
                                            {% set subclass_options = data_page_template.get(subclass_key, {}) %}
                                            {% else %}
                                            {% set subclass_options = {} %}
                                            {% endif %}

                                            {% set all_options = {} %}
                                            {% for k, v in class_options.items() %}
                                            {% set _ = all_options.update({k: v}) %}
                                            {% endfor %}
                                            {% for k, v in subclass_options.items() %}
                                            {% set _ = all_options.update({k: v}) %}
                                            {% endfor %}

                                            {% for choice in all_options.values() %}
                                            <div class="mb-3">
                                                <label class="form-label">{{ choice['name'] }}</label>

                                                {% if choice.get('options') %}
                                                <select class="form-select bg-primary" data-uuid="{{ choice['UUID'] }}"
                                                    onchange="postClassChoice(this)">
                                                    <option value="0">Select Option</option>

                                                    {% set current_choice = known_dict.get(choice['UUID']|lower) %}
                                                    {% for option, description in choice['options'].items() %}
                                                    <option value="{{ option }}" data-description="{{ description }}" {%
                                                        if current_choice==option %}selected{% endif %}>
                                                        {{ option }}
                                                    </option>
                                                    {% endfor %}
                                                </select>

                                                {% elif choice.get('choices') %}
                                                <select class="form-select bg-primary" data-uuid="{{ choice['UUID'] }}"
                                                    onchange="postClassChoice(this)">
                                                    <option value="0">Select Option</option>

                                                    {% set current_choice = known_dict.get(choice['UUID']|lower) %}
                                                    {% for option in choice['choices'] %}
                                                    <option value="{{ option }}" {% if current_choice==option
                                                        %}selected{% endif %}>
                                                        {{ option }}
                                                    </option>
                                                    {% endfor %}
                                                </select>

                                                {% else %}
                                                <p class="text-muted small">No selectable options.</p>
                                                {% endif %}

                                            </div>
                                            {% endfor %}

                                        </div>

                                        <div class="col-lg-4">
                                            <div id="classchoice-description" class="border rounded p-3 bg-light"
                                                style="min-height:150px;">
                                                <p class="text-muted">Select an option to see its description.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>


                            <!-- STATS TAB -->
                            <div class="tab-pane fade p-3" id="nav-stats" role="tabpanel" aria-labelledby="nav-stats">
                                <div class="tab-scroll-wrapper-edit-mode">
                                    <div class="col-12 col-md-7 px-md-3">
                                        <div class="order-md-1">
                                            <div class="row">
                                                <div class="bg-light row mx-0 py-1">
                                                    <div class="col-2 ">
                                                        <div class="row">
                                                            <!-- <p class="h3 my-0">+5</p> -->
                                                        </div>
                                                        <div class="row ">
                                                            <h3>Value</h3>
                                                        </div>
                                                    </div>
                                                    <div class="col-10 align-self-center">
                                                        <p class="h3 w-100 word-wrap: break-word px-4">Atribute Name</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- Individual Atribute -->
                                            {% for item in data_page_template["atributes"] %}
                                            <div class="row ">
                                                <div class="bg-light row mx-0 py-1">
                                                    <!-- Levý sloupec s hodnotou -->
                                                    <div class="col-2 d-flex align-items-center justify-content-center">
                                                        <input
                                                            class="form-control border-0 bg-primary text-center ms-2 auto_update_stats"
                                                            style="width: 70px; height: 70px; font-size: 2rem; box-shadow: none;"
                                                            id='{{ item["name"].lower() }}'
                                                            value='{{ character[item["name"]] }}'>
                                                    </div>

                                                    <!-- Pravý sloupec s názvem + proficiency -->
                                                    <div class="col-10 align-self-center">
                                                        <p class="h3 w-100 text-wrap px-4">{{ item["name"] }}</p>
                                                        {% set skill_key = item["name"] | lower | replace(' ', '_') %}
                                                        {% set level = proficiencies.get(skill_key, 1) %}
                                                        <div class="row px-2">
                                                            <div class="col-12 d-flex gap-3">
                                                                <div class="form-check">
                                                                    <input class="form-check-input" type="radio"
                                                                        id="skillNone_{{ skill_key }}"
                                                                        name="skill_{{ skill_key }}_mobile" value="1" {%
                                                                        if level==1 %}checked{% endif %}
                                                                        onchange="updateSkill('{{ item['name'].lower() }}', this.value)">
                                                                    <label class="form-check-label"
                                                                        for="skillNone_{{ skill_key }}">None</label>
                                                                </div>

                                                                <div class="form-check">
                                                                    <input class="form-check-input" type="radio"
                                                                        id="skillProficient_{{ skill_key }}"
                                                                        name="skill_{{ skill_key }}_mobile" value="2" {%
                                                                        if level==2 %}checked{% endif %}
                                                                        onchange="updateSkill('{{ item['name'].lower() }}', this.value)">
                                                                    <label class="form-check-label"
                                                                        for="skillProficient_{{ skill_key }}">Proficient</label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Skills tab -->
                            <div class="tab-pane fade p-3" id="nav-skills" role="tabpanel" aria-labelledby="nav-skills">
                                <div class="tab-scroll-wrapper-edit-mode">
                                    <div class="bg-light row  px-0">
                                        <!-- Header -->

                                        <!-- Scrollable skills container -->
                                        <div class="col-12 skills-container overflow-auto" style="max-height: 80vh;">
                                            {% for item in data_page_template["skills"] %}
                                            {% set skill_key = item["name"] | lower | replace(' ', '_') %}
                                            {% set level = proficiencies.get(skill_key, 1) %}
                                            <div class="bg-light row px-3 py-2 mb-2 rounded-0">
                                                <!-- Skill name -->
                                                <div class="col-12">
                                                    <p class="h5 w-100 text-wrap mb-2">{{ item["name"] }}</p>
                                                </div>

                                                <!-- Radios -->
                                                <div class="col-12 d-flex gap-3 flex-wrap">
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="radio"
                                                            id="skillNone_{{ skill_key }}"
                                                            name="skill_{{ skill_key }}_mobile" value="1" {% if level==1
                                                            %}checked{% endif %}
                                                            onchange="updateSkill('{{ skill_key }}', this.value)">
                                                        <label class="form-check-label"
                                                            for="skillNone_{{ skill_key }}">None</label>
                                                    </div>

                                                    <div class="form-check">
                                                        <input class="form-check-input" type="radio"
                                                            id="skillProficient_{{ skill_key }}"
                                                            name="skill_{{ skill_key }}_mobile" value="2" {% if level==2
                                                            %}checked{% endif %}
                                                            onchange="updateSkill('{{ skill_key }}', this.value)">
                                                        <label class="form-check-label"
                                                            for="skillProficient_{{ skill_key }}">Proficient</label>
                                                    </div>

                                                    <div class="form-check">
                                                        <input class="form-check-input" type="radio"
                                                            id="skillExpertise_{{ skill_key }}"
                                                            name="skill_{{ skill_key }}_mobile" value="3" {% if level==3
                                                            %}checked{% endif %}
                                                            onchange="updateSkill('{{ skill_key }}', this.value)">
                                                        <label class="form-check-label"
                                                            for="skillExpertise_{{ skill_key }}">Expertise</label>
                                                    </div>
                                                </div>
                                            </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <script>
                        document.addEventListener("change", function (e) {
                            // === FEATS popis ===
                            if (e.target.closest("#nav-feats select")) {
                                const desc = e.target.selectedOptions[0]?.dataset.description || "No description available.";
                                const box = document.getElementById("feat-description");
                                if (box) box.innerHTML = `<p>${desc}</p>`;
                            }

                            // === CLASS CHOICES popis ===
                            if (e.target.closest("#nav-classchoices select")) {
                                const desc = e.target.selectedOptions[0]?.dataset.description || "No description available.";
                                const box = document.getElementById("classchoice-description");
                                if (box) box.innerHTML = `<p>${desc}</p>`;
                            }
                        });
                    </script>

                    <script>
                        document.addEventListener("DOMContentLoaded", () => {
                            const raceSelect = document.getElementById("char_race");
                            const classSelect = document.getElementById("char_class");
                            const subclassSelect = document.getElementById("char_subclass");

                            // 🟢 Triggery pro změnu race / class / subclass
                            [raceSelect, classSelect, subclassSelect].forEach(select => {
                                select.addEventListener("change", () => {
                                    fetch("/api/update_character_options", {
                                        method: "POST",
                                        headers: { "Content-Type": "application/json" },
                                        body: JSON.stringify({
                                            char_race: raceSelect.value,
                                            char_class: classSelect.value,
                                            char_subclass: subclassSelect.value
                                        })
                                    })
                                        .then(res => res.json())
                                        .then(data => {
                                            // aktualizace feats
                                            updateFeatUI(data.feat_levels, data.feats);

                                            // aktualizace class choices (včetně subclass-specific)
                                            updateClassChoicesUI(data.class_choices);

                                            // aktualizace subclass dropdownu při změně classy
                                            if (select === classSelect && subclassSelect) {
                                                subclassSelect.innerHTML = '<option value="">-- Žádná --</option>';
                                                if (data.subclasses && Array.isArray(data.subclasses)) {
                                                    data.subclasses.forEach(subclass => {
                                                        const option = document.createElement("option");
                                                        option.value = subclass;
                                                        option.textContent = subclass
                                                            .replace(/_/g, " ")
                                                            .replace(/\b\w/g, l => l.toUpperCase());
                                                        subclassSelect.appendChild(option);
                                                    });
                                                }
                                            }
                                        })
                                        .catch(err => console.error("Chyba při aktualizaci:", err));
                                });
                            });

                            // === Aktualizace Feats ===
                            function updateFeatUI(featLevels, feats) {
                                const featsContainer = document.querySelector("#nav-feats .col-lg-8");
                                featsContainer.innerHTML = "";
                                featLevels.forEach(conf => {
                                    const wrapper = document.createElement("div");
                                    wrapper.classList.add("mb-3");

                                    const label = document.createElement("label");
                                    label.classList.add("form-label");
                                    label.textContent = conf.label;

                                    const select = document.createElement("select");
                                    select.classList.add("form-select", "bg-primary");
                                    select.dataset.level = conf.level;
                                    select.onchange = () => postFeat(select);

                                    const defaultOption = document.createElement("option");
                                    defaultOption.value = "0";
                                    defaultOption.textContent = "Select Feat";
                                    select.appendChild(defaultOption);

                                    feats.forEach(f => {
                                        if (
                                            (conf.filter === "origin" && f.type === "origin") ||
                                            (conf.filter === "non-epic" && f.type !== "epic") ||
                                            conf.filter === "all"
                                        ) {
                                            const opt = document.createElement("option");
                                            opt.value = f.UUID;
                                            opt.textContent = f.name;
                                            opt.dataset.description = f.description || "";
                                            select.appendChild(opt);
                                        }
                                    });

                                    wrapper.appendChild(label);
                                    wrapper.appendChild(select);
                                    featsContainer.appendChild(wrapper);
                                });
                            }

                            // === Aktualizace Class Choices ===
                            function updateClassChoicesUI(classChoices) {
                                const classContainer = document.querySelector("#nav-classchoices .col-lg-8");
                                classContainer.innerHTML = "";

                                classChoices.forEach(choice => {
                                    const wrapper = document.createElement("div");
                                    wrapper.classList.add("mb-3");

                                    const label = document.createElement("label");
                                    label.classList.add("form-label");
                                    label.textContent = choice.name;

                                    const select = document.createElement("select");
                                    select.classList.add("form-select", "bg-primary");
                                    select.dataset.uuid = choice.UUID;
                                    select.onchange = () => postClassChoice(select);

                                    const defaultOption = document.createElement("option");
                                    defaultOption.value = "0";
                                    defaultOption.textContent = "Select Option";
                                    select.appendChild(defaultOption);

                                    if (choice.options) {
                                        for (const [opt, desc] of Object.entries(choice.options)) {
                                            const o = document.createElement("option");
                                            o.value = opt;
                                            o.textContent = opt;
                                            o.dataset.description = desc;
                                            select.appendChild(o);
                                        }
                                    }

                                    wrapper.appendChild(label);
                                    wrapper.appendChild(select);
                                    classContainer.appendChild(wrapper);
                                });
                            }
                        });
                    </script>






                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
            crossorigin="anonymous"></script>
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
            integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
            crossorigin="anonymous"></script>
</body>

</html>